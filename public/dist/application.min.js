"use strict";var ApplicationConfiguration=function(){var applicationModuleName="brightbi",applicationModuleVendorDependencies=["ngResource","ngAnimate","ngMessages","ui.router","ui.bootstrap","ui.utils","angularFileUpload","ngGrid","angularBootstrapNavTree","pascalprecht.translate"],registerModule=function(moduleName){angular.module(moduleName,[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!1),$locationProvider.hashPrefix("!")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$state","Authentication","Dialogs","$interval",function($rootScope,$state,Authentication,Dialogs,$interval){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.data&&toState.data.authenticate&&!Authentication.user){var modalInstance=null,stop=$interval(function(){modalInstance||(modalInstance=Dialogs.openDialog("modules/users/views/authentication-dialog.html","AuthenticationDialogController",function(){return{status:"signin"}},function(){modalInstance=null,$interval.cancel(stop),$state.transitionTo(toState,toParams)},function(){modalInstance=null}))},1e3);fromState&&fromState.name?$state.transitionTo(fromState,fromParams):$state.transitionTo("home"),event.preventDefault()}})}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("comment"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("dashboard"),ApplicationConfiguration.registerModule("users"),ApplicationConfiguration.registerModule("wpts"),angular.module("comment").directive("commentable",[function(){return{templateUrl:"/modules/comment/views/commentable.html",scope:{commentable:"=",commentableType:"@",src:"=",objId:"&",user:"="},controller:["$scope","$http",function($scope,$http){function _resetFormComment(){$scope.formComment=null,$scope.formComment={}}function _commentResetState(comment){comment.replying=!1,comment.editing=!1}var commentable={};$scope.comments=[],$scope.formComment={};var transformToTree=function(originalArray,subArray,parentId){for(var i=0;i<originalArray.length;i++){var item=originalArray[i];if(null===parentId&&!item.parentId||null!==parentId&&parentId===item.parentId){var newItem=angular.copy(item);newItem.children=[],subArray.push(newItem),transformToTree(originalArray,newItem.children,item._id)}}},findParent=function(array,parentId){for(var retItem=null,i=0;i<array.length;i++){var item=array[i];if(item._id===parentId){retItem=item;break}if(item.children&&item.children.length>0&&(retItem=findParent(item.children,parentId)))break}return retItem};$scope.$watch("src",function(path){path&&commentable.getComments(path).success(function(res){var newArray=[];transformToTree(res,newArray,null),$scope.comments=newArray})}),$scope.commentEdit=function(comment){comment.interact=comment.body,comment.editing=!0,comment.replying=!1},$scope.commentReply=function(comment){comment.interact="",comment.replying=!0,comment.editing=!1},$scope.cancelComment=function(comment){_commentResetState(comment)},$scope.createComment=function(){$scope.formComment.body&&commentable.createComment($scope.commentableType,$scope.commentable,$scope.formComment.body).success(function(response){_resetFormComment(),$scope.comments.push(response)})},$scope.updateComment=function(comment){commentable.updateComment(comment._id,comment.interact).success(function(response){_commentResetState(comment),angular.extend(comment,response)})},$scope.replyComment=function(comment){commentable.replyComment(comment,comment.interact).success(function(response){_commentResetState(comment),comment.children=comment.children||[],comment.children.push(angular.extend({replying:!1,editing:!1,interact:""},response))})},$scope.deleteComment=function(comment){commentable.deleteComment(comment._id).success(function(){_commentResetState(comment);var i;if(comment.parentId){var parent=findParent($scope.comments,comment.parentId);if(parent&&parent.children)for(i=0;i<parent.children.length;i++)if(parent.children[i]._id===comment._id){parent.children.splice(i,1);break}}else for(i=0;i<$scope.comments.length;i++)if($scope.comments[i]._id===comment._id){$scope.comments.splice(i,1);break}})},commentable.getComments=function(path){return $http.get(path+$scope.objId())},commentable.createComment=function(commentableType,commentableObj,body){var data={comment:{commentableType:commentableType,commentableId:commentableObj._id,body:body}};return $http.post("/comments",data)},commentable.updateComment=function(commentId,commentBody){var data={comment:{body:commentBody}};return $http.put("/comments/"+commentId,data)},commentable.replyComment=function(parentComment,commentBody){var data={comment:{commentableType:parentComment.commentableType,commentableId:parentComment.commentableId,parentId:parentComment._id,body:commentBody}};return $http.post("/comments",data)},commentable.deleteComment=function(commentId){return $http.delete("/comments/"+commentId)}}]}}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.html",controller:"HomeController"})}]),angular.module("core").config(["$translateProvider",function($translateProvider){$translateProvider.translations("en",{MENU_SIGNUP:"Sign Up",MENU_SIGNIN:"Sign In",MENU_FORGOT:"Forgot password",MENU_EDIT_PROFILE:"Edit Profile",MENU_CHANGE_PASSWORD:"Change Password",MENU_SIGNOUT:"Sign Out",MENU_DASHBOARD:"Dashboard",MENU_WEBPIVOTTABLE:"WebPivotTable",MENU_WEBPIVOTTABLE_SAVE:"Save WPT",MENU_LOADDATA:"Load Data",MENU_LOADCUBE:"Load Cube",MENU_SAVEREPORT:"Save Report",MENU_SHAREREPORT:"Share Report",ACTION_RESET_PASSWORD:"Reset Password",ACTION_YOUR_ACCOUNT:"Your Account ( {{username}} )",ACTION_CREATE_NEW_REPORT:"Create New Report",ACTION_QUICK_SEARCH:"Quick Search",ACTION_DELETE:"Delete",ACTION_OPEN_REPORT:"Open Report",DASHBOARD_ACTIVE_REPORTS:"Active Reports",DASHBOARD_ARCHIVED_REPORTS:" Archived Reports",DASHBOARD_ACCOUNT_TITLE:"User: {{name}} ",DASHBOARD_REPORT_TITLE:"Report: {{title}} ",LANGUAGE_ENGLISH:"English",LANGUAGE_CHINESE:"Chinese",LANGUAGE_FRENCHE:"French",HOME_TITLE:"Bright BI",HOME_DESCRIPTION:"Bright BI (Business Intelligence) system is a BI solution leverage Brightsea WebPivotTable component to analyze data dynamically and to share reports within enterprise.",HOME_LEARN_MORE:"Learn more",SIGNIN_TITLE:"Sign in to BrightBI",SIGNIN_USERNAME:"Username",SIGNIN_PASSWORD:"Password",SIGNUP_TITLE:"Sign up for BrightBI",SIGNUP_FIRSTNAME:"First Name",SIGNUP_LASTNAME:"Last Name",SIGNUP_EMAIL:"Email",SIGNUP_USERNAME:"Username",SIGNUP_PASSWORD:"Password",FORGOT_TITLE:"Request Password Reset",RESET_TITLE:"Reset Password",NEW_PASSWORD:"New Password",CONFIRM_PASSWORD:"Confirm Password",PROFILE_EDIT_TITLE:"Edit your profile",PASSWORD_CHANGE_TITLE:"Change your password",CURRENT_PASSWORD:"Current Password",DIALOG_DATA_LOAD_TITLE:"Load data to create new report",DATA_FILE_TYPE:"Data file type",DATA_FILE_TYPE_WPT:"WebPivotTable file (.wpt)",DATA_FILE_TYPE_CSV:"CSV file (.csv)",DATA_FILE_TYPE_XLS:"Excel (97-2003) file (.xls)",DATA_FILE_TYPE_XLSX:"Excel (2004 +) file (.xlsx)",DATA_FILE_SOURCE:"Data file source",DATA_FILE_SOURCE_LOCAL:"Local Drive",DATA_FILE_SOURCE_LINK:"Internet Link",DATA_FILE_SOURCE_CLOUD:"Cloud Drive",DATA_FILE_URL:"Data file URL",DIALOG_CUBE_LOAD_TITLE:"Load OLAP cube to create new report",CUBE_XMLA_URL:"OLAP XMLA URL",DIALOG_REPORT_SAVE_TITLE:"Save current report",REPORT_SAVE_TO_LOCAL:"Save to local",REPORT_SAVE_TO_SERVER:"Save to server",REPORT_TITLE:"Title",REPORT_DESCRIPTION:"Description",REPORT_ARCHIVED:"Archived",REPORT_FILE_NAME:"File Name",REPORT_SAVE_LOCAL_NOT_SUPPORT:"Your browser does not support to save file to local, please try use a HTML5 browser!",REPORT_SAVE_SIGNIN_FIRST:"Please Sign in first!",REPORT_URL:"Report URL",REPORT_SEND_TO:"Send report to",DIALOG_REPORT_SHARE_TITLE:"Share current report",ACTION_LOAD:"Load",ACTION_ABORT:"Abort",ACTION_OK:"Ok",ACTION_CANCEL:"Cancel",ACTION_SELECT_LOCAL:"Select a file from local drive",ACTION_SELECT_CLOUD:"Select a file from cloud drive",ACTION_SAVE:"Save",ACTION_GET:"Get",ACTION_UPDATE:"Update",ACTION_SEND:"Send",COMMENT_TITLE:"Comments",COMMENT_ADD_COMMENT:"Add Comment...",COMMENT_EDIT_COMMENT:"Edit comment...",COMMENT_REPLY_COMMENT:"Reply...",COMMENT_SAVE:"Save",COMMENT_REPLY:"Reply",COMMENT_EDIT:"Edit",COMMENT_DELETE:"Delete",COMMENT_UPDATE:"Update",COMMENT_CANCEL:"Cancel",MESSAGE_RESET_EMAIL_SENT:"An e-mail has been sent to this address with further instructions.",MESSAGE_PROFILE_UPDATE_SUCCESS:"Success! Your profile has been updated.",MESSAGE_PASSWORD_RESET_SUCCESS:"Success! Your password has been changed.",MESSAGE_SAVE_LOCAL_SUCCESS:"Report saved to local successfully.",MESSAGE_SAVE_SERVER_SUCCESS:"Report saved to server successfully.",MESSAGE_REPORT_SHARE_SUCCESS:"Report shared successfully.",ERROR_SERVER_GENERAL:"Server side error!",ERROR_UNKNOWN_USER:"This user has not signed up yet!",ERROR_INVALID_PASSWORD:"Password is wrong!",ERROR_USERNAME_EMAIL_DUPLICATE:"This username or email signed up already!",ERROR_REQUIRED:"Please input {{field}}.",ERROR_NO_USER_WITH_THIS_EMAIL:"No user with this email address!",ERROR_RESET_TOKEN_INVALID:"Password reset token is invalid or has expired!",ERROR_CONFIRM_PASSWORD:"Two passwords are not the same, please input again!",ERROR_USER_NOT_SIGNIN:"User is not signed in yet!",ERROR_CURRENT_PASSWORD:"Current password is incorrect!",ERROR_NEW_PASSWORD:"Please provide a new password!",ERROR_USER_NOT_FOUND:"User is not found!",ERROR_VALIDATION_SERVER:"Request Failed Due to Server Error!",ERROR_VADIDATION_NOT_FOUND:"Not Found!",ERROR_VADIDATION_WAIT:"Please Wait!",ERROR_VADIDATION_REQUIRED:"This field is required!",ERROR_VADIDATION_TOO_SHORT:"This field is too short!",ERROR_VADIDATION_TOO_LONG:"This field is too long!",ERROR_VADIDATION_EMAIL:"Email is not valid!",ERROR_UPLOAD_FILE:"Failed to upload file!",ERROR_REQUEST_FILE_URL:"Failed to request file content by URL!",ERROR_FILE_PICKER:"Failed to pick a file from cloud drive!",ERROR_FILE_TYPE:"Selected a wrong file type!",ERROR_FILE_NOT_FOUND:"File not found!",ERROR_FILE_NOT_READABLE:"File not readable!",ERROR_FILE_READ_SECURITY:"File is in a locked state!",ERROR_FILE_READ_DEFAULT:"File read error!",ERROR_EXCEL_NO_SHEET:"No sheet in excel file!",ERROR_READ_EXCEL_FILE:"Failed to read excel file!",ERROR_NOT_WPT_FILE:"This is not a valid WebPivotTable file!",ERROR_NO_DATA_IN_REPORT:"No data in report yet!"}),$translateProvider.translations("zh",{MENU_SIGNUP:"注册",MENU_SIGNIN:"登录",MENU_FORGOT:"忘记密码",MENU_EDIT_PROFILE:"修改个人资料",MENU_CHANGE_PASSWORD:"修改密码",MENU_SIGNOUT:"退出",MENU_DASHBOARD:"仪表板",MENU_WEBPIVOTTABLE:"数据透视表",MENU_WEBPIVOTTABLE_SAVE:"保存数据透视表",MENU_LOADDATA:"加载数据",MENU_LOADCUBE:"加载多维数据集",MENU_SAVEREPORT:"保存报表",MENU_SHAREREPORT:"分享报表",ACTION_RESET_PASSWORD:"重设密码",ACTION_YOUR_ACCOUNT:"您的账户 ( {{username}} )",ACTION_CREATE_NEW_REPORT:"创建新报表",ACTION_QUICK_SEARCH:"快速搜索",ACTION_DELETE:"删除",ACTION_OPEN_REPORT:"打开报表",DASHBOARD_ACTIVE_REPORTS:"激活的报表",DASHBOARD_ARCHIVED_REPORTS:" 归档的报表",DASHBOARD_ACCOUNT_TITLE:"用户： {{name}} ",DASHBOARD_REPORT_TITLE:"报表： {{title}} ",LANGUAGE_ENGLISH:"英语",LANGUAGE_CHINESE:"中文",HOME_TITLE:"Bright BI",HOME_DESCRIPTION:"Bright BI (商业智能)系统是基于Brightsea公司WebPivotTable组件的对企业数据进行动态分析并在企业内部共享报表的商业智能解决方案。",HOME_LEARN_MORE:"了解更多",SIGNIN_TITLE:"登录到BrightBI",SIGNIN_USERNAME:"用户名",SIGNIN_PASSWORD:"密码",SIGNUP_TITLE:"注册到BrightBI",SIGNUP_FIRSTNAME:"名",SIGNUP_LASTNAME:"姓",SIGNUP_EMAIL:"Email",SIGNUP_USERNAME:"用户名",SIGNUP_PASSWORD:"密码",FORGOT_TITLE:"请求重设密码",RESET_TITLE:"重设密码",NEW_PASSWORD:"新密码",CONFIRM_PASSWORD:"确定密码",PROFILE_EDIT_TITLE:"修改您的档案",PASSWORD_CHANGE_TITLE:"修改密码",CURRENT_PASSWORD:"当前密码",DIALOG_DATA_LOAD_TITLE:"加载数据以创建新的报表",DATA_FILE_TYPE:"数据文件类型",DATA_FILE_TYPE_WPT:"WEB数据透视表文件 (.wpt)",DATA_FILE_TYPE_CSV:"CSV文件 (.csv)",DATA_FILE_TYPE_XLS:"Excel (97-2003)文件 (.xls)",DATA_FILE_TYPE_XLSX:"Excel (2004 +)文件 (.xlsx)",DATA_FILE_SOURCE:"数据文件源",DATA_FILE_SOURCE_LOCAL:"本地驱动盘",DATA_FILE_SOURCE_LINK:"互联网链接",DATA_FILE_SOURCE_CLOUD:"云驱动盘",DATA_FILE_URL:"数据文件URL",DIALOG_CUBE_LOAD_TITLE:"加载OLAP多维数据集以创建新的报表",CUBE_XMLA_URL:"OLAP XMLA URL",DIALOG_REPORT_SAVE_TITLE:"保存当前报表",REPORT_SAVE_TO_LOCAL:"保存在本机",REPORT_SAVE_TO_SERVER:"保存到服务器",REPORT_TITLE:"标题",REPORT_DESCRIPTION:"描述",REPORT_ARCHIVED:"已归档",REPORT_FILE_NAME:"文件名",REPORT_SAVE_LOCAL_NOT_SUPPORT:"您当前使用的浏览器不支持保存文件到本地，请试着用一个HTML5的浏览器！",REPORT_SAVE_SIGNIN_FIRST:"请先登录！",REPORT_URL:"报表 URL",REPORT_SEND_TO:"发送报表到",DIALOG_REPORT_SHARE_TITLE:"分享当前报表",ACTION_LOAD:"加载",ACTION_ABORT:"放弃",ACTION_OK:"确定",ACTION_CANCEL:"取消",ACTION_SELECT_LOCAL:"从本地驱动盘选取文件",ACTION_SELECT_CLOUD:"从云驱动盘选取文件",ACTION_SAVE:"保存",ACTION_GET:"获取",ACTION_UPDATE:"更新",ACTION_SEND:"发送",COMMENT_TITLE:"所有评论",COMMENT_ADD_COMMENT:"增加评论...",COMMENT_EDIT_COMMENT:"编辑评论...",COMMENT_REPLY_COMMENT:"回复评论...",COMMENT_SAVE:"保存",COMMENT_REPLY:"回复",COMMENT_EDIT:"编辑",COMMENT_DELETE:"删除",COMMENT_UPDATE:"更新",COMMENT_CANCEL:"取消",MESSAGE_RESET_EMAIL_SENT:"重设密码邮件已经发送到该邮件地址，请查收邮件！",MESSAGE_PROFILE_UPDATE_SUCCESS:"成功了！ 你的档案已被更改。",MESSAGE_PASSWORD_RESET_SUCCESS:"成功了！ 你的密码已被更改。",MESSAGE_SAVE_LOCAL_SUCCESS:"报表成功保存到本地文件。",MESSAGE_SAVE_SERVER_SUCCESS:"报表成功保存到服务器上。",MESSAGE_REPORT_SHARE_SUCCESS:"报表分享成功。",ERROR_SERVER_GENERAL:"服务器端出错！",ERROR_UNKNOWN_USER:"该用户还没有注册！",ERROR_INVALID_PASSWORD:"密码错误！",ERROR_USERNAME_EMAIL_DUPLICATE:"该用户名或者电子邮箱已经被注册！",ERROR_REQUIRED:"请输入{{field}}",ERROR_NO_USER_WITH_THIS_EMAIL:"该邮件地址没有对应的用户！",ERROR_RESET_TOKEN_INVALID:"密码重设盾牌不对或者已经过期！",ERROR_CONFIRM_PASSWORD:"两个密码不一样， 请重输！",ERROR_USER_NOT_SIGNIN:"用户还没有登录！",ERROR_CURRENT_PASSWORD:"当前密码不正确！",ERROR_NEW_PASSWORD:"请提供一个新密码！",ERROR_USER_NOT_FOUND:"用户没找到！",ERROR_VALIDATION_SERVER:"服务器错误导致请求失败！",ERROR_VADIDATION_NOT_FOUND:"没找到！",ERROR_VADIDATION_WAIT:"请等待！",ERROR_VADIDATION_REQUIRED:"这个字段是必须的！",ERROR_VADIDATION_TOO_SHORT:"这个字段太短！",ERROR_VADIDATION_TOO_LONG:"这个字段太长！",ERROR_VADIDATION_EMAIL:"Email不正确！",ERROR_UPLOAD_FILE:"上传文件失败！",ERROR_REQUEST_FILE_URL:"用URL请求文件内容失败！",ERROR_FILE_PICKER:"从云盘选取文件失败！",ERROR_FILE_TYPE:"文件类型选择错误！",ERROR_FILE_NOT_FOUND:"找不到文件！",ERROR_FILE_NOT_READABLE:"文件不可读！",ERROR_FILE_READ_SECURITY:"文件处于被锁定状态！",ERROR_FILE_READ_DEFAULT:"读取文件错误！",ERROR_EXCEL_NO_SHEET:"EXCEL文件中无表单！",ERROR_READ_EXCEL_FILE:"读取EXCEL文件失败！",ERROR_NOT_WPT_FILE:"这不是一个有效的WEB数据透视表文件！",ERROR_NO_DATA_IN_REPORT:"当前报表中还没有数据！"}),$translateProvider.preferredLanguage("en")}]),angular.module("core").controller("ConfirmDialogController",["$scope","$modalInstance","parameters",function($scope,$modalInstance,parameters){$scope.data={title:parameters.title},$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss()}}]),angular.module("core").controller("HeaderController",["$scope","$state","$stateParams","Authentication","Menus","Locales","Dialogs","$translate","$location","$timeout","$http",function($scope,$state,$stateParams,Authentication,Menus,Locales,Dialogs,$translate,$location,$timeout,$http){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.currentLocale=Locales.getCurrentLocale(),$scope.availableLocales=Locales.getAvailableLocales(),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1}),$scope.showWptMenu=function(){return $state.includes("wpt")},$scope.showLoadDataMenu=function(){return $state.includes("wpt.public")},$scope.showWptEditMenu=function(){return $state.includes("wpt.edit")},$scope.openAuthenticationDialog=function(screen){Dialogs.openDialog("modules/users/views/authentication-dialog.html","AuthenticationDialogController",function(){return{screen:screen}})},$scope.signout=function(){$http.get("/auth/signout").success(function(){$scope.authentication.user=null;var currentState=$state.get($state.$current);currentState.data&&currentState.data.authenticate&&$state.transitionTo("home")}).error(function(){})},$scope.openProfileEditDialog=function(){Dialogs.openDialog("modules/users/views/profile-edit-dialog.html","AccountDialogController")},$scope.openPasswordChangeDialog=function(){Dialogs.openDialog("modules/users/views/password-change-dialog.html","AccountDialogController")},$scope.openSaveReportDialog=function(){Dialogs.openDialog("modules/wpts/views/report-save.html","ReportSaveController")},$scope.openShareReportDialog=function(){Dialogs.openDialog("modules/wpts/views/report-share.html","ReportShareController",function(){return{url:$location.absUrl()}})},$scope.openLoadDataDialog=function(){Dialogs.openDialog("modules/wpts/views/data-load.html","DataLoadController")},$scope.openLoadCubeDialog=function(){Dialogs.openDialog("modules/wpts/views/cube-load.html","CubeLoadController")},$scope.changeLocale=function(locale){Locales.setCurrentLocale(locale.value),$scope.currentLocale=Locales.getCurrentLocale(),$translate.use(locale.value),$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})}}]),angular.module("core").controller("HomeController",["$scope","Authentication","Dialogs",function($scope,Authentication,Dialogs){$scope.authentication=Authentication,$scope.openAuthenticationDialog=function(screen){Dialogs.openDialog("modules/users/views/authentication-dialog.html","AuthenticationDialogController",function(){return{screen:screen}})}}]),angular.module("core").service("Dialogs",["$modal",function($modal){this.openDialog=function(templateUrl,controller,resolveFunc,successCB,errorCB){var modalInstance=$modal.open({templateUrl:templateUrl,controller:controller,resolve:{parameters:resolveFunc||function(){return null}}});return modalInstance.result.then(successCB||function(){},errorCB||function(){}),modalInstance},this.confirmDialog=function(resolveFunc,successCB,errorCB){var modalInstance=$modal.open({templateUrl:"modules/core/views/confirm-dialog.html",controller:"ConfirmDialogController",resolve:{parameters:resolveFunc||function(){return null}}});return modalInstance.result.then(successCB||function(){},errorCB||function(){}),modalInstance}}]),angular.module("core").service("Locales",[function(){this.defaultLocale="en";var currentLocale=null;this.localeDefs=[{value:"en",translationId:"LANGUAGE_ENGLISH",attach:"english"},{value:"zh",translationId:"LANGUAGE_CHINESE",attach:"中文"},{value:"fr",translationId:"LANGUAGE_FRENCH",attach:"français"}],this.availableLocales=["en","zh"],this.getCurrentLocale=function(){var retLocale=null;return angular.forEach(this.localeDefs,function(locale){locale.value===currentLocale&&(retLocale=locale)},this),retLocale},this.getAvailableLocales=function(){var retLocales=[];return angular.forEach(this.availableLocales,function(localeValue){angular.forEach(this.localeDefs,function(locale){locale.value===localeValue&&retLocales.push(locale)},this)},this),retLocales},this.setCurrentLocale=function(locale){currentLocale=locale},this.setCurrentLocale("en")}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["user"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:isPublic||this.menus[menuId].isPublic,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:isPublic||this.menus[menuId].isPublic,roles:roles||this.defaultRoles,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("core").service("Statuses",[function(){this.loading=!1,this.errorId=null,this.errors=[],this.messageId=null,this.messages=[],this.reset=function(){this.loading=!1,this.errorId=null,this.errors=[],this.messageId=null,this.messages=[]},this.set=function(status){this.loading=!1,this.errorId=status.errorId,this.errors=status.errors||[],this.messageId=status.messageId,this.messages=status.messages||[]},this.startLoading=function(){this.reset(),this.loading=!0},this.endLoading=function(){this.loading=!1}}]),angular.module("dashboard").config(["$stateProvider",function($stateProvider){$stateProvider.state("dashboard",{url:"/dashboard",templateUrl:"modules/dashboard/views/dashboard.html",controller:"DashboardController",data:{authenticate:!0}}).state("dashboard.account",{url:"/account",templateUrl:"modules/dashboard/views/dashboard-account.html",controller:"DashboardAccountController"}).state("dashboard.report",{url:"/:id",templateUrl:"modules/dashboard/views/dashboard-report.html",controller:"DashboardReportController"})}]),angular.module("dashboard").controller("DashboardAccountController",["$scope","Dialogs",function($scope,Dialogs){$scope.openProfileEditDialog=function(){Dialogs.openDialog("modules/users/views/profile-edit-dialog.html","AccountDialogController")},$scope.openPasswordChangeDialog=function(){Dialogs.openDialog("modules/users/views/password-change-dialog.html","AccountDialogController")}}]),angular.module("dashboard").controller("DashboardController",["$scope","$state","$stateParams","$location","Authentication","Wpts","$http","$timeout","$log","$modal",function($scope,$state,$stateParams,$location,Authentication,Wpts){$scope.authentication=Authentication,$scope.status={activeOpen:!0,archiveOpen:!0},$scope.query="",$scope.wpts=Wpts.query(),$scope.isArchived=function(item){return!!item.archived},$scope.isNotArchived=function(item){return!item.archived},$scope.showAccount=function(){$state.transitionTo("dashboard.account")},$scope.showReport=function(wpt){$state.transitionTo("dashboard.report",{id:wpt._id})}}]),angular.module("dashboard").controller("DashboardReportController",["$scope","$state","$stateParams","Wpts","Dialogs","$location",function($scope,$state,$stateParams,Wpts,Dialogs,$location){$scope.reportGetting=!0,Wpts.get({wptId:$stateParams.id},function(response){$scope.report=response,$scope.reportGetting=!1},function(){$scope.reportGetting=!1}),$scope.openShareReportDialog=function(){Dialogs.openDialog("modules/wpts/views/report-share.html","ReportShareController",function(){return{url:$location.absUrl().replace($location.url(),"/wpt/edit/"+$stateParams.id)}})},$scope.remove=function(){Dialogs.confirmDialog(function(){return{title:"Are you sure to delete this report?"}},function(){Wpts.delete({wptId:$scope.report._id},function(){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})})})},$scope.update=function(){Wpts.update({wptId:$scope.report._id},$scope.report,function(){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})})},$scope.currentReportId=function(){return $stateParams.id}}]),angular.module("dashboard").controller("ReportCreateController",["$scope","$modalInstance","$timeout","$upload",function($scope,$modalInstance,$timeout,$upload){$scope.fileTypes=[{value:"wpt",label:"WebPivotTable file"},{value:"csv",label:"CSV file"},{value:"xls",label:"Excel (97-2003) file"},{value:"xlsx",label:"Excel (2004 +) file"}],$scope.data={fileType:$scope.fileTypes[0],title:"",description:""},$scope.abort=function(){$scope.upload.abort(),$scope.upload=null},$scope.onFileSelect=function($files){$scope.selectedFile=$files.length>0?$files[0]:null,$scope.progress=-1,$scope.upload&&$scope.upload.abort(),$scope.upload=null,$scope.uploadResult=null},$scope.start=function(){$scope.progress=0,$scope.errorMsg=null,$scope.upload=$upload.upload({url:"wpts/upload",method:"POST",headers:$scope.data,file:$scope.selectedFile,fileFormDataName:"myFile"}),$scope.upload.then(function(response){$scope.uploadResult=response.data},function(response){response.status>0&&($scope.errorMsg=response.status+": "+response.data)},function(evt){$scope.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})},$scope.ok=function(){$modalInstance.close("dashboard.report")},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("wpts").factory("Wpts",["$resource",function($resource){return $resource("wpts/:wptId",{wptId:"@_id"},{get:{method:"GET",params:{wptId:"@_id"}}},{"delete":{method:"DELETE",params:{wptId:"@_id"}}},{update:{method:"PUT"}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/signup.html",controller:"AuthenticationController"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/signin.html",controller:"AuthenticationController"}).state("forgot",{url:"/forgot",templateUrl:"modules/users/views/password-forgot.html",controller:"AuthenticationController"}).state("reset",{url:"/reset/:token",templateUrl:"modules/users/views/password-reset.html",controller:"PasswordResetController"})}]),angular.module("users").controller("AccountDialogController",["$scope","$http","$location","Users","Authentication","$modalInstance","Statuses",function($scope,$http,$location,Users,Authentication,$modalInstance,Statuses){$scope.statuses=Statuses,$scope.user=angular.copy(Authentication.user),$scope.passwordDetails={},$scope.user||$location.path("/"),Statuses.reset(),$scope.updateUserProfile=function(){Statuses.startLoading();var user=new Users($scope.user);user.$update(function(response){Statuses.endLoading(),Authentication.user=response,Statuses.set({messageId:"MESSAGE_PROFILE_UPDATE_SUCCESS"})},function(response){Statuses.set(response.data)})},$scope.changeUserPassword=function(){Statuses.startLoading(),$http.post("/users/password",$scope.passwordDetails).success(function(){Statuses.set({messageId:"MESSAGE_PASSWORD_RESET_SUCCESS"})}).error(function(error){Statuses.set(error)})},$scope.cancel=function(){$modalInstance.dismiss()}}]),angular.module("users").controller("AuthenticationDialogController",["$scope","$http","Authentication","$modalInstance","parameters","Statuses",function($scope,$http,Authentication,$modalInstance,parameters,Statuses){$scope.authentication=Authentication,$scope.statuses=Statuses,$scope.screen=parameters.screen||"signin",$scope.credentials={},Statuses.reset(),$scope.signin=function(){Statuses.startLoading(),$http.post("/auth/signin",$scope.credentials).success(function(response){Statuses.endLoading(),$scope.authentication.user=response,$modalInstance.close()}).error(function(error){Statuses.set(error)})},$scope.signup=function(){Statuses.startLoading(),$http.post("/auth/signup",$scope.credentials).success(function(response){Statuses.endLoading(),$scope.authentication.user=response,$modalInstance.close()}).error(function(error){Statuses.set(error)})},$scope.forgot=function(){Statuses.startLoading(),$http.post("/auth/forgot",$scope.credentials).success(function(){Statuses.set({messageId:"MESSAGE_RESET_EMAIL_SENT"})}).error(function(error){Statuses.set(error)})},$scope.switchToScreen=function(screen){$scope.screen=screen,Statuses.reset()},$scope.cancel=function(){$modalInstance.dismiss()}}]),angular.module("users").controller("PasswordResetController",["$scope","$http","Authentication","$stateParams","$state","Statuses",function($scope,$http,Authentication,$stateParams,$state,Statuses){$scope.authentication=Authentication,$scope.statuses=Statuses,$http.get("/users/reset?token="+$stateParams.token).success(function(response){$scope.authentication.user=response}).error(function(error){$scope.authentication.user=null,Statuses.set(error)}),Statuses.reset(),$scope.data={},$scope.reset=function(){Statuses.startLoading(),$scope.data.password!==$scope.data.confirmPassword?Statuses.set({errorId:"ERROR_CONFIRM_PASSWORD"}):$http.post("/users/reset?token="+$stateParams.token,$scope.data).success(function(){Statuses.set({messageId:"MESSAGE_PASSWORD_RESET_SUCCESS"})}).error(function(error){Statuses.set(error)})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http.delete("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message
})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]),angular.module("wpts").config(["$stateProvider",function($stateProvider){$stateProvider.state("wpt",{"abstract":!0,url:"/wpt",template:"<ui-view/>"}).state("wpt.public",{url:"/public",templateUrl:"modules/wpts/views/wpt-edit.html",controller:"WptEditController"}).state("wpt.edit",{url:"/edit/:wptId",templateUrl:"modules/wpts/views/wpt-edit.html",controller:"WptEditController",data:{authenticate:!0}})}]),angular.module("wpts").controller("CubeLoadController",["WptComponent","$scope","$modalInstance","$timeout","Statuses",function(WptComponent,$scope,$modalInstance,$timeout,Statuses){$scope.statuses=Statuses,Statuses.reset(),$scope.cubeTreeData=[],$scope.data={xmlaUrl:"http://bi2.io:8080/mondrian/xmla"};var transformToTree=function(originalArray,subArray,parentId){for(var i=0;i<originalArray.length;i++){var item=originalArray[i];if(null===parentId?!item.parentId:item.parentId===parentId){var newItem=angular.copy(item);newItem.label=item.name,newItem.children=[],subArray.push(newItem),transformToTree(originalArray,newItem.children,item.id)}}};$scope.getCubeTree=function(){Statuses.startLoading(),$scope.cubeTreeData=[],$scope.cubeSelected=null,WptComponent.getInstance().getCubeTree(1,$scope.data.xmlaUrl,function(response){transformToTree(response,$scope.cubeTreeData,null)},function(message){$timeout(function(){Statuses.set({messages:[message]})})})},$scope.loadCube=function(){$scope.cubeSelected&&($modalInstance.close(),WptComponent.getInstance().setOlapCube({xmlaUrl:$scope.data.xmlaUrl,DataSourceInfo:$scope.cubeSelected.DataSourceInfo,Catalog:$scope.cubeSelected.xmlaData.CATALOG_NAME,CubeName:$scope.cubeSelected.xmlaData.CUBE_NAME}))},$scope.onSelectCube=function(branch){"CUBE"===branch.type?($scope.cubeSelected=branch,Statuses.reset()):$scope.cubeSelected=null},$scope.cancel=function(){$modalInstance.dismiss()}}]),angular.module("wpts").controller("DataLoadController",["WptComponent","$scope","$modalInstance","$timeout","$upload","$http","Statuses",function(WptComponent,$scope,$modalInstance,$timeout,$upload,$http,Statuses){$scope.statuses=Statuses,Statuses.reset(),$scope.fileReaderSupported=window.FileReader&&(!window.FileAPI||window.FileAPI&&window.FileAPI.html5),$scope.fileTypes=[{value:"wpt",label:"DATA_FILE_TYPE_WPT"},{value:"csv",label:"DATA_FILE_TYPE_CSV"},{value:"xls",label:"DATA_FILE_TYPE_XLS"},{value:"xlsx",label:"DATA_FILE_TYPE_XLSX"}],$scope.data={fileType:"wpt",fileUrl:"http://bi2.io/json/sample51.wpt"},$scope.selectTab=function(){Statuses.reset()},$scope.abort=function(){$scope.upload.abort(),$scope.upload=null},$scope.onFileSelect=function($files){Statuses.reset(),$scope.selectedFile=$files.length>0?$files[0]:null,$scope.progress=-1,$scope.upload&&$scope.upload.abort(),$scope.upload=null};var handleFileContent=function(content,encoding){var workbook,fileContent,wptObject,type=encoding||"binary";switch($scope.data.fileType){case"wpt":try{wptObject=angular.fromJson(content),wptObject.format&&"WPT"===wptObject.format?($modalInstance.close(),WptComponent.getInstance().setWptObject(wptObject)):Statuses.set({errorId:"ERROR_NOT_WPT_FILE"})}catch(error){Statuses.set({errorId:"ERROR_NOT_WPT_FILE",errors:[error]})}break;case"csv":$modalInstance.close(),WptComponent.getInstance().setCsvRawData(content);break;case"xls":try{workbook=window.XLS.read(content,{type:type}),workbook.SheetNames.length>0?(fileContent=window.XLS.utils.make_csv(workbook.Sheets[workbook.SheetNames[0]]),$modalInstance.close(),WptComponent.getInstance().setCsvRawData(fileContent)):Statuses.set({errorId:"ERROR_EXCEL_NO_SHEET"})}catch(error){Statuses.set({errorId:"ERROR_READ_EXCEL_FILE",errors:[error]})}break;case"xlsx":try{workbook=window.XLSX.read(content,{type:type}),workbook.SheetNames.length>0?(fileContent=window.XLSX.utils.sheet_to_csv(workbook.Sheets[workbook.SheetNames[0]]),$modalInstance.close(),WptComponent.getInstance().setCsvRawData(fileContent)):Statuses.set({errorId:"ERROR_EXCEL_NO_SHEET"})}catch(error){Statuses.set({errorId:"ERROR_READ_EXCEL_FILE",errors:[error]})}}};$scope.start=function(){if($scope.selectedFile.name.split(".").pop().toLowerCase()!==$scope.data.fileType)return void Statuses.set({errorId:"ERROR_FILE_TYPE"});if($scope.progress=0,Statuses.startLoading(),$scope.fileReaderSupported){var fileReader=new FileReader;fileReader.onprogress=function(evt){evt.lengthComputable&&($scope.progress=Math.min(100,parseInt(100*evt.loaded/evt.total)))},fileReader.onload=function(evt){evt.target.readyState===window.FileReader.DONE&&handleFileContent(evt.target.result)},fileReader.onerror=function(evt){switch(evt=evt||window.event,evt.target.error.code){case evt.target.error.NOT_FOUND_ERR:Statuses.set({errorId:"ERROR_FILE_NOT_FOUND"});break;case evt.target.error.NOT_READABLE_ERR:Statuses.set({errorId:"ERROR_FILE_NOT_READABLE"});break;case evt.target.error.SECURITY_ERR:Statuses.set({errorId:"ERROR_FILE_READ_SECURITY"});break;default:Statuses.set({errorId:"ERROR_FILE_READ_DEFAULT"})}},"wpt"===$scope.data.fileType||"csv"===$scope.data.fileType?fileReader.readAsText($scope.selectedFile):fileReader.readAsBinaryString($scope.selectedFile)}else $scope.upload=$upload.upload({url:"/wpt/uploadFile",method:"POST",headers:$scope.data,file:$scope.selectedFile,fileFormDataName:"myFile"}),$scope.upload.then(function(response){"xls"===$scope.data.fileType||"xlsx"===$scope.data.fileType?handleFileContent(response.data,"base64"):handleFileContent(response.data)},function(response){response.status>0&&response.data&&Statuses.set({errorId:response.data.errorId,errors:[response.data.error]})},function(evt){$scope.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})};var getDataByFileUrl=function(fileType,fileUrl){$http.post("/wpt/getDataByFileUrl",{fileType:fileType,fileUrl:fileUrl}).success(function(response){"xls"===fileType||"xlsx"===fileType?handleFileContent(response,"base64"):handleFileContent(response)}).error(function(response){Statuses.set({errorId:response.errorId,errors:[response.error]})})};$scope.downloadFile=function(){Statuses.startLoading(),getDataByFileUrl($scope.data.fileType,$scope.data.fileUrl)},$scope.cancel=function(){$modalInstance.dismiss()};var filepicker=window.filepicker;filepicker.setKey(window.filepickerKey),$scope.fpFile=null,$scope.downloadFPFile=function(){return Statuses.startLoading(),$scope.fpFile.filename.split(".").pop().toLowerCase()!==$scope.data.fileType?void Statuses.set({errorId:"ERROR_FILE_TYPE"}):void getDataByFileUrl($scope.data.fileType,$scope.fpFile.url)},$scope.gotoCloudDrive=function(){Statuses.startLoading(),filepicker.pick(function(FPFile){$timeout(function(){$scope.fpFile=FPFile,Statuses.endLoading()})},function(error){Statuses.set({errorId:"ERROR_FILE_PICKER",errors:[error]})})}}]),angular.module("wpts").controller("ReportSaveController",["WptComponent","$scope","$modalInstance","$timeout","$http","$state","$log","Authentication","Dialogs","Statuses",function(WptComponent,$scope,$modalInstance,$timeout,$http,$state,$log,Authentication,Dialogs,Statuses){$scope.authentication=Authentication,$scope.statuses=Statuses,Statuses.reset();try{$scope.isFileSaverSupported=!!new Blob}catch(e){$scope.isFileSaverSupported=!1}$scope.data={fileName:"report.wpt",title:"",description:""},$scope.savedReportId=null,$scope.selectTab=function(){Statuses.reset()},$scope.saveToLocal=function(){Statuses.startLoading();var wptComponent=WptComponent.getInstance();if(wptComponent.data&&0!==wptComponent.data.length)try{var blob=new Blob([wptComponent.generateWptString()],{type:"text/plain;charset=utf-8"});window.saveAs(blob,$scope.data.fileName),Statuses.set({messageId:"MESSAGE_SAVE_LOCAL_SUCCESS"})}catch(error){Statuses.set({errorId:"ERROR_SAVE_LOCAL",errors:[error]})}else Statuses.set({errorId:"ERROR_NO_DATA_IN_REPORT"})},$scope.saveToServer=function(){$scope.savedReportId=null,Statuses.startLoading();var wptComponent=WptComponent.getInstance();wptComponent.data&&0!==wptComponent.data.length?$http.post("/wpt/saveReport",{title:$scope.data.title,description:$scope.data.description,wpt:wptComponent.generateWptString()}).success(function(response){$scope.savedReportId=response._id,Statuses.set({messageId:"MESSAGE_SAVE_SERVER_SUCCESS"})}).error(function(error){Statuses.set(error)}):Statuses.set({errorId:"ERROR_NO_DATA_IN_REPORT"})},$scope.openSavedReport=function(){$state.transitionTo("wpt.edit",{wptId:$scope.savedReportId}),$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss()},$scope.openAuthenticationDialog=function(screen){Dialogs.openDialog("modules/users/views/authentication-dialog.html","AuthenticationDialogController",function(){return{screen:screen}})}}]),angular.module("wpts").controller("ReportShareController",["WptComponent","$scope","$modalInstance","parameters","$http","Statuses","Authentication",function(WptComponent,$scope,$modalInstance,parameters,$http,Statuses,Authentication){$scope.authentication=Authentication,$scope.statuses=Statuses,Statuses.reset(),$scope.data={url:parameters.url,user:$scope.authentication.user},$scope.share=function(){Statuses.startLoading(),$http.post("/wpt/shareReport",$scope.data).success(function(){Statuses.set({messageId:"MESSAGE_REPORT_SHARE_SUCCESS"})}).error(function(error){Statuses.set(error)})},$scope.cancel=function(){$modalInstance.dismiss()}}]),angular.module("wpts").controller("WptEditController",["WptComponent","$scope","$state","$stateParams","Locales","$location","Authentication","Wpts","$http","$timeout",function(WptComponent,$scope,$state,$stateParams,Locales,$location,Authentication,Wpts,$http,$timeout){$scope.authentication=Authentication,WptComponent.destroyInstance();var createWebPivotTable=function(loadDataFlag){require(["wpt/WebPivotTable"],function(WebPivotTable){$timeout(function(){var webpivottable=new WebPivotTable({customOptions:{locale:Locales.getCurrentLocale().value,uiFlags:{menuBtn:1,dataSourceBtn:0,languageSwitchBtn:0,helpBtn:0,aboutBtn:0,openWptMenu:0,saveWptMenu:0,sourceDataMenu:1,exportReportMenu:0,settingMenu:1,csvFileMenu:0,xlsFileMenu:0,xlsxFileMenu:0,gssFileMenu:0,olapCubeMenu:0,internetLinkMenu:0,localDriveMenu:0,cloudDriveMenu:0,copyPasteMenu:0}}},"wpt-container");WptComponent.setInstance(webpivottable),loadDataFlag&&$http({url:"/wptfiles",method:"GET",params:{wptFileId:$scope.wpt.reportFileId}}).then(function(response){webpivottable.setWptObject(response.data)})})},1e3)};$state.includes("wpt.public")?createWebPivotTable(!1):$scope.wpt=Wpts.get({wptId:$stateParams.wptId},function(){createWebPivotTable(!0)}),$scope.$on("$destroy",function(){WptComponent.destroyInstance()}),$scope.create=function(){var wpt=new Wpts({title:this.title,content:this.content});wpt.$save(function(response){$location.path("wpts/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message}),this.title="",this.description="",this.content=""},$scope.remove=function(wpt){if(wpt){wpt.$remove();for(var i in $scope.wpts)$scope.wpts[i]===wpt&&$scope.wpts.splice(i,1)}else $scope.wpt.$remove(function(){$location.path("wpts")})},$scope.update=function(){var wpt=$scope.wpt;wpt.$update(function(){$location.path("wpts/"+wpt._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.wpts=Wpts.query()},$scope.findOne=function(){$scope.wpt=Wpts.get({wptId:$stateParams.wptId})}}]),angular.module("wpts").factory("WptComponent",[function(){var instance=null,getInstance=function(){return instance},setInstance=function(object){instance=object},destroyInstance=function(){instance&&(instance.destroyRecursive(),instance=null)};return{getInstance:getInstance,setInstance:setInstance,destroyInstance:destroyInstance}}]),angular.module("wpts").factory("Wpts",["$resource",function($resource){return $resource("wpts/:wptId",{wptId:"@_id"},{get:{method:"GET",params:{wptId:"@_id"}},"delete":{method:"DELETE",params:{wptId:"@_id"}},update:{method:"PUT"}})}]);